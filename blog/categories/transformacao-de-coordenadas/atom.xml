<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Transformação De Coordenadas | QGIS-PT]]></title>
  <link href="http://qgis.pt/categories/transformacao-de-coordenadas/atom.xml" rel="self"/>
  <link href="http://qgis.pt/"/>
  <updated>2014-08-14T20:23:04+01:00</updated>
  <id>http://qgis.pt/</id>
  <author>
    <name><![CDATA[Grupo de Utilizadores QGIS PT]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Transformação De Coordenadas E Utilização Das Grelhas NTv2 No QGIS]]></title>
    <link href="http://qgis.pt/2014/07/13/transformacao-de-coordenadas-e-utilizacao-das-grelhas-ntv2-no-qgis/"/>
    <updated>2014-07-13T23:47:03+01:00</updated>
    <id>http://qgis.pt/2014/07/13/transformacao-de-coordenadas-e-utilizacao-das-grelhas-ntv2-no-qgis</id>
    <content type="html"><![CDATA[<p>A crescente evolução dos Sistemas de Informação Geográfica, e a sua “democratização”, tanto pela via da simplificação, como pelo desenvolvimento de software aberto para SIG de 
   grande qualidade, de onde se destaca o QGIS,<!-- more --> tem permitido a um número cada vez maior de utilizadores, oriundos das mais diversas áreas do conhecimento, trabalhar com informação 
   geográfica. Muitos desses novos utilizadores, quiçá a maioria, não possuem conhecimentos de Ciências Cartográficas ou Geodesia, e enfrentam grandes dificuldades na utilização dos 
   Sistemas de Coordenadas.</p>




<p>Com efeito, uma das características fundamentais da Informação Geográfica é a sua georreferenciação ou, mais simplesmente, a associação a uma posição no espaço, 
identificada por um conjunto de coordenadas.</p>




<p>Os sistemas de coordenadas utilizados para georreferenciação podem classificar-se em três classes fundamentais [1]:</p>


<ol>
    <li>Sistemas de coordenadas cartesianos tridimensionais, geocêntricos, com sistemas de eixos com origem próximo do centro de massa da Terra e coordenadas X, Y, Z.</li>
    <li>Sistemas de coordenadas geodésicos ou elipsoidais, resultantes do ajustamento de uma superfície elipsoidal (com definição matemática conhecida) ao geóide, 
        em função de um sistema de coordenadas cartesiano tridimensional ou de observações astronómicas. As coordenadas geodésicas elipsoidais são definidas por latitude, 
        longitude e altitude elipsoidal (φ, λ, h).</li>
    <li>Sistemas de coordenadas cartográficos ou planos, obtidos a partir das coordenadas elipsoidais, por intermédio de uma projecção cartográfica, à qual se associa um 
        sistema de coordenadas cartesianas bidimensionais.</li>
</ol>




<p>Grande parte da complexidade associada aos sistemas de coordenadas advém do facto da Terra não ser uma superfície regular e plana, e da cartografia se processar, inevitavelmente, 
   num plano (folha de papel, ecrã de computador, etc.). Esta situação encontra-se bem ilustrada numa animação de 1947, denominada “The Impossible Map” [2]. 
   Assim, houve necessidade de encontrar mecanismos que permitissem solucionar esse problema.</p>




<p>O geóide é a figura que mais se aproxima da forma da Terra, correspondendo a uma superfície equipotencial do campo gravítico terrestre, próxima do nível médio das águas do mar.</p>




<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/1_modelo_geoide.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/1_modelo_geoide.png" width="300"  alt="Modelo do geóide">
    </a>
</div>




<p class="img-leg">Modelo do geóide (GOCE-ESA [3])</p>




<p>O geóide possui uma geometria bastante complexa, difícil de definir matematicamente, pelo que se usa o elipsóide para fazer a sua aproximação.</p>




<p>A utilização de um elipsóide como superfície de referência para suporte à georreferenciação, requer a definição de um conjunto de parâmetros: dimensão, forma e posição. O estabelecimento 
   desses parâmetros, materializados num ponto, constitui a definição de um Datum Geodésico [1]. Esse ponto, designado ponto de fixação, é o ponto de uma rede geodésica que estabelece as 
   relações entre o geóide e o elipsóide de referência, e entre as coordenadas astronómicas e as coordenadas geodésicas [4].</p>




<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/2_ondulacao_geoide.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/2_ondulacao_geoide.png" width="500"  alt="Ondulação do geóide">
    </a>
</div>




<p>Um elipsóide pode ser posicionado de forma a ajustar-se melhor a uma pequena zona do geóide (por exemplo, um país), designando-se por datum local (como o datum Lisboa ou o datum 73), 
   ou pode ser ajustado à totalidade do geóide, designando-se por datum global (como o WGS84 ou o ETRS89). Nos data locais, o ponto de fixação é escolhido de forma a minimizar as 
   distâncias entre o geóide e o elipsóide.</p>




<p>O primeiro datum geodésico definido em Portugal foi o datum Lisboa, fixado no Castelo de S. Jorge ainda no século XIX. Mais tarde, foi definido o datum 73, fixado no vértice geodésico 
   de Melriça. Durante o séc. XX, foi também utilizado o datum Europeu ED50.</p>




<p>Com a popularização dos sistemas de navegação por satélite, começaram a privilegiar-se os sistemas de coordenadas baseados em data globais, como o WGS84 e, mais recentemente, na Europa, 
   o ETRS89, que é coincidente com o WGS84 em 1989. O ETRS89 é materializado por um conjunto de estações fixadas na placa euro-asiática, evitando assim a variação nas coordenadas do WGS84, 
   que ocorre devido ao movimento das placas tectónicas. Apesar de tudo, esse movimento é bastante lento, levando a que, para a maioria das aplicações, o WGS84 se possa considerar igual ao 
   ETRS89 [5].</p>




<p>Também ao nível das projecções, foram utilizadas diversas em Portugal, desde a projecção de Bonne, à projecção de Gauss-Kruger e ao sistema UTM.</p>




<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/3_sistemas_projeccao_pt.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/3_sistemas_projeccao_pt.png" width="500"  alt="Sistemas de projecção utilizados no território do continente">
    </a>
</div>




<p class="img-leg">Sistemas de projecção utilizados no território do continente. Da esquerda para a direita: Bessel-Bonne-Lisboa, Hayford-Gauss-Lisboa, Hayford-Gauss-Melriça e 
   Hayford-Gauss-Militar. PC designa o Ponto Central da projecção; o triângulo assinala o ponto de fixação do datum; a letra O designa a origem das coordenadas cartográficas; os 
   números I a IV identificam os quadrantes em cada sistema (Gaspar, J. A., 2000, citado em [6])</p>




<p>Do anteriormente exposto se depreende que existe informação geográfica produzida em distintos sistemas de referência, que é necessário compatibilizar, através de
   operações de transformação de coordenadas.</p>




<p>Existem diferentes métodos de transformação, dependendo do tipo de coordenadas em que se pretende efectuar essa transformação mas, de um modo genérico, todos requerem a identificação 
   do sistema de coordenadas em que os dados se encontram e de um conjunto de parâmetros de transformação entre esse sistema e o WGS84, que acaba por funcionar como um sistema intermédio. 
   Esses parâmetros são calculados a partir de pontos de coordenadas conhecidas em diversos sistemas e são, por isso, dependentes do conjunto de pontos utilizados, motivo que explica a 
   existência de diferentes parâmetros de transformação envolvendo os mesmos sistemas e os mesmos métodos. Vamos ver mais adiante que, por exemplo, a actual Direcção-Geral do Território 
   (DGT) disponibilizou, ao longo dos anos, diferentes parâmetros [oficiais] de transformação de Bursa-Wolf e Molodensky, do datum Lisboa e do datum 73 para WGS84 e, mais recentemente, 
   para ETRS89.</p>




<p>A conversão entre diferentes tipos de coordenadas num mesmo datum é exacta, ou seja, a passagem de coordenadas cartesianas tridimensionais para coordenadas geodésicas, e destas para 
  cartográficas, é feita sem qualquer incerteza ou erro, pois existem fórmulas matemáticas que viabilizam essa conversão [1].</p>




<p>Pelo contrário, se as coordenadas se encontrarem em data diferentes, a transformação já implica algum erro, que depende de um conjunto de factores como o método de transformação, 
   os pontos referenciados em ambos os sistemas, entre outros.</p>




<p>A imagem seguinte resume o processo de conversão e transformação entre sistemas de coordenadas.</p>




<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/4_Conversoes_Transformacoes_Coord.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/4_Conversoes_Transformacoes_Coord.png" width="500"  alt="Conversão e transformação entre sistemas de coordenadas">
    </a>
</div>




<p class="img-leg">Conversão e transformação entre sistemas de coordenadas (Adaptado de [1])</p>




<p>Uma vez que as transformações com funções polinomiais são de uso bastante restrito, podemos dizer que na transformação entre dois sistemas de coordenadas cartográficas, 
   cada um deles baseado num datum geodésico diferente, teremos 4 transformações, 2 de projecção e 2 de datum, podendo ainda estar envolvidas 2 conversões entre coordenadas geodésicas 
   e cartesianas tridimensionais. A imagem seguinte esquematiza esse processo, representando a passagem do sistema de coordenadas cartográficas 1 (PCS1) ao 2 (PCS2), sendo conhecidas as 
   relações de cada datum geodésico (GCS) com um datum global [7] (geralmente, o WGS84). </p>




<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/5_conv_coordenadas_jag.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/5_conv_coordenadas_jag.png" width="500"  alt="Conversão geral entre sistemas de coordenadas projectadas">
    </a>
</div>




<p class="img-leg">Conversão geral entre sistemas de coordenadas projectadas (E, N): PCS1 (Projected Coordinate System), no datum local 1, para PCS2, no datum local 2. (λ, φ) são as 
   coordenadas geográficas nos diferentes GCS (Geographic Coordinate System) [7]</p>




<p>Os softwares de SIG, de um modo geral, lidam desta forma com as conversões de coordenadas [8]. Os métodos mais clássicos de transformação são o de Bursa-Wolf e o de Molodensky. A DGT 
   determina e disponibiliza no seu site [9], para cada datum local, os parâmetros que o relacionam com um datum global, viabilizando dessa forma qualquer conversão.</p>




<p>A transformação de Bursa-Wolf é uma transformação em coordenadas cartesianas tridimensionais, fazendo uso de um conjunto de 7 parâmetros, que envolvem translacção, rotação e efeito 
   de escala [5].</p>




<p>A transformação de Molodensky, ou de 3 parâmetros, processa-se sobre coordenadas geodésicas e é um método diferencial em que os parâmetros produzidos são diferenças a aplicar às 
   coordenadas do sistema de partida [10].</p>




<p>No quadro seguinte apresentam-se os erros das transformações para datum Lisboa e datum 73.</p>




<table class="table">
    <tr>
        <th rowspan="2">Transformação</th>
        <th rowspan="2">Erro</th>
        <th colspan="2">Datum Lisboa</th>
        <th colspan="2">Datum 73</th>
    </tr>
    <tr>
        <th>eM (m)</th>
        <th>eP (m)</th>
        <th>eM (m)</th>
        <th>eP (m)</th>
    </tr>
    <tr>
        <td rowspan="2">Bursa-Wolf</td>
        <td>Médio quadrático</td>
        <td>1.40</td>
        <td>1.49</td>
        <td>0.38</td>
        <td>0.36</td>
    </tr>
    <tr>
        <td>Máximo absoluto</td>
        <td>5.10</td>
        <td>4.15</td>
        <td>1.35</td>
        <td>1.08</td>
    </tr>
    <tr>
        <td rowspan="2">Molodensky</td>
        <td>Médio quadrático</td>
        <td>1.69</td>
        <td>1.60</td>
        <td>0.84</td>
        <td>0.56</td>
    </tr>
    <tr>
        <td>Máximo absoluto</td>
        <td>4.47</td>
        <td>5.03</td>
        <td>2.11</td>
        <td>1.87</td>
    </tr>
</table>




<p class="img-leg">Erros em M (Meridiano) e P (Paralelo) encontrados nas transformações (Bursa-Wolf e Molodensky) de datum ETRS89 para os data Lisboa e 73, nos pontos da rede geodésica,
    usando os parâmetros do IGP (citado em [7]).</p>




<p>Como se pode constatar, os erros introduzidos nas transformações, especialmente no caso do datum Lisboa, são relativamente grandes e não são compatíveis com escalas cartográficas grandes,
   como 1:2.000, 1:1.000 ou superior [7].</p>




<p>Assim, para essas escalas, é necessário utilizar outros métodos de transformação mais rigorosos, como é o caso do método das grelhas de diferenças de coordenadas geográficas entre um 
   datum local e um datum global. Essas grelhas são obtidas a partir de pontos de referência conhecidos nos dois sistemas, como é o caso dos pontos da Rede Geodésica Nacional.</p>




<p>O prof. José Alberto Gonçalves (FCUP) criou grelhas de transformação de coordenadas a partir de 940 pontos das redes geodésicas de 1ª e 2ª ordem (cujas coordenadas eram disponibilizadas 
   pelo ex-IGP), através do cálculo das diferenças de longitudes e latitudes, dos data locais para ETRS89. De seguida procedeu a uma interpolação espacial (krigagem) dessas diferenças, 
   para gerar superfícies contínuas, com espaçamento de 1 décimo de grau, que cobrem todo o território de Portugal continental, no formato NTv2 (com extensão .gsb), que é o standard 
   suportado pelos softwares de SIG.</p>




<p>As estatísticas dos erros obtidos na transformação de 147 pontos da rede de 3ª ordem (que não entraram na elaboração das grelhas), pelo método das grelhas, estão patentes no quadro 
   seguinte.</p>




<table class="table">
    <tr>
        <th rowspan="2"></th>
        <th colspan="2">Datum Lisboa</th>
        <th colspan="2">Datum 73</th>
    </tr>
    <tr>
        <th>eM (m)</th>
        <th>eP (m)</th>
        <th>eM (m)</th>
        <th>eP (m)</th>
    </tr>
    <tr>
        <td>Média</td>
        <td>-0.005</td>
        <td>0.004</td>
        <td>0.004</td>
        <td>-0.008</td>
    </tr>
    <tr>
        <td>Desvio Padrão</td>
        <td>0.073</td>
        <td>0.087</td>
        <td>0.052</td>
        <td>0.047</td>
    </tr>
    <tr>
        <td>Mínimo</td>
        <td>-0.336</td>
        <td>-0.391</td>
        <td>-0.387</td>
        <td>-0.318</td>
    </tr>
    <tr>
        <td>Máximo</td>
        <td>0.314</td>
        <td>0.479</td>
        <td>0.228</td>
        <td>0.267</td>
    </tr>
</table>




<p class="img-leg">Estatísticas dos erros da transformação com grelhas de Datum Lisboa e de Datum 73 para ETRS89, em 147 pontos da rede geodésica não utilizados na geração das grelhas
   [7].</p>




<p>Verifica-se, de facto, que o método das grelhas é bastante mais rigoroso do que os métodos de Bursa-Wolf ou Molodensky. No caso do datum Lisboa, o erro das transformações de 3 e 7 
   parâmetros é quase tão grande como se simplesmente se tivessem considerado as coordenadas ETRS89 projectadas, iguais às coordenadas Hayford-Gauss datum Lisboa [8], cujas diferenças 
   atingem, no máximo, 8m, no extremo Noroeste de Portugal continental [5].</p>




<p>Entretanto, a DGT também disponibilizou grelhas de transformação de coordenadas. Para a sua elaboração, utilizou 1129 vértices da Rede Geodésica Nacional, observados com GPS. Através de 
   uma interpolação por kriging, gerou as grelhas de diferenças (de datum 73 para ETRS89 e de datum Lisboa para ETRS89), com espaçamento de 1',2. A precisão da transformação foi estimada 
   com base em 130 vértices geodésicos (que também não entraram para o cálculo das grelhas), tendo obtido os valores da tabela seguinte [11]:</p>




<table class="table">
    <tr>
        <th></th>
        <th>Datum Lisboa</th>
        <th>Datum 73</th>
    </tr>
    <tr>
        <td>e.m.q. (m)</td>
        <td>0.09</td>
        <td>0.06</td>
    </tr> 
    <tr>
        <td>Máximo Abs. (m)</td>
        <td>0.30</td>
        <td>0.16</td>
    </tr> 
</table>




<p>Desta forma, conclui-se que, sempre que estejam disponíveis grelhas de transformação, esse método é preferível em relação aos métodos de Bursa-Wolf ou Molodensky. Ainda assim, o 
   QGIS suporta, como veremos de seguida, através das bibliotecas PROJ.4, todos esses métodos de transformação de coordenadas, pelo que a escolha do método a adoptar dependerá da vontade 
   de cada um e do rigor necessário para a aplicação em causa.</p>




<h3>Sistemas de Coordenadas no QGIS</h3>




<p>Tal como a maioria dos softwares de SIG actualmente existentes, o QGIS lida com os sistemas de referência através das bibliotecas PROJ.4 e das bibliotecas GDAL. Por sua vez, estas 
   recorrem aos códigos EPSG (European Petroleum Survey Group, actualmente integrado no OGP Surveying and Positioning Committee) [12] [13], para identificar um grande número de sistemas de 
   coordenadas e transformações definidos nessa base de dados, de uma forma standard e compatível com o que é usado por diversas aplicações [8]. Os códigos e as transformações 
   disponibilizados pelo EPSG são regularmente actualizados de acordo com as alterações que lhe são solicitadas, uma vez que, como já se referiu anteriormente, esses parâmetros são 
   dependentes do conjunto de pontos utilizados, motivo que explica a existência de diferentes parâmetros de transformação envolvendo os mesmos sistemas e os mesmos métodos. Na maioria dos 
   casos, os novos parâmetros substituem os antigos.</p>




<p>Esta arquitectura facilita bastante a utilização e a integração dos sistemas de coordenadas, promovendo a interoperabilidade entre softwares. Assim, aquando da instalação, o QGIS 
   sincroniza a base de dados onde armazena os sistemas de coordenadas e as transformações com o GDAL e o PROJ.4. </p>




<p>Para o utilizador, todo este processo é totalmente transparente e apenas tem de se preocupar com duas coisas:</p>


<ul>
    <li>Sistema de referência do projecto QGIS</li>
    <li>Sistema de referência dos dados que vai utilizar</li>
</ul>




<p>Quanto ao primeiro, no menu <b>Configurações / Settings -> Opções... / Options... ->  separador SRC / CRS</b>, o utilizador pode definir o sistema de referência que pretende usar 
   por defeito, isto é, aquele que vai surgir atribuído ao projecto, sempre que abre o QGIS. A escolha deste parâmetro deverá depender dos dados com que normalmente trabalha. 
   No caso da imagem seguinte, o SRC definido por defeito é o PT-TM06/ETRS89 (EPSG:3763) porque a maioria dos dados com que se trabalha actualmente em Portugal continental, se encontra 
   nesse sistema.</p>




<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/6_srs_projecto.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/6_srs_projecto.png" width="500"  alt="Definição dos sistemas de referência no QGIS">
    </a>
</div>




<p>A outra opção destacada na imagem anterior, está relacionada com a segunda questão com que o utilizador de informação geográfica terá sempre de se preocupar, que é o sistema  de 
   referência dos dados que vai utilizar. Essa importância advém do facto de não se poderem usar dados em diferentes sistemas, sem proceder a uma transformação. Sem essa noção, o utilizador
   pode, muitas vezes, ver-se confrontado com situações em que dados do mesmo local, obtidos por diversos métodos (levantamentos com GPS, digitalização sobre cartografia antiga, detecção 
   remota, etc.) ou a partir de diferentes fontes ou instituições, não ficam sobrepostos e/ou correctamente alinhados.</p>




<p>Efectivamente, existe em Portugal informação geográfica numa grande diversidade de sistemas de referência. Como exemplo, pode referir-se: muita cartografia geológica que se encontra 
   ainda no sistema de Bessel-Bonne datum Lisboa; a Carta Militar de Portugal Série M888 e cartografia produzida pelo Instituto da Conservação da Natureza e das Florestas, que utilizam o 
   sistema Hayford-Gauss Militar datum Lisboa; muita cartografia urbana de maior escala, produzida no sistema Hayford-Gauss datum 73; ou as últimas séries de ortofotomapas do ex-IGP, 
   bem como as últimas versões da Carta Administrativa Oficial de Portugal, produzidas no PT-TM06/ETRS89. Esta situação levanta problemas aos utilizadores menos experientes, quando tentam 
   sobrepor cartografia em sistemas de referência diferentes.</p>




<p>Assim, a opção seleccionada na imagem, faz com que, ao adicionar uma nova layer de informação (sempre que o QGIS não consiga detectar automaticamente o seu sistema de referência), seja 
   mostrada uma janela para o utilizador indicar qual o sistema de referência da layer que está a carregar no projecto QGIS.</p>




<p>A melhor forma de saber qual o sistema em que os dados se encontram, é procurar nos metadados disponibilizados pela entidade produtora. Uma outra opção, é procurar essa informação nos 
   próprios dados. Por exemplo, no caso de uma shapefile, que, como se sabe, é constituída por um conjunto de ficheiros com o mesmo nome (extensões .shp, .dbf, .shx, .qpj, .prj, etc.), 
   pode analisar-se, com um editor de texto, o conteúdo do ficheiro .prj: </p>


<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='r'><span class='line'>PROJCS<span class="p">[</span><span class="o">&amp;</span>ldquo<span class="p">;</span>ETRS89 <span class="o">/</span> Portugal TM06<span class="o">&amp;</span>rdquo<span class="p">;,</span><span class="o">&lt;/</span>p<span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span>pre<span class="o">&gt;&lt;</span>code<span class="o">&gt;</span>GEOGCS<span class="p">[</span><span class="s">&quot;ETRS89&quot;</span><span class="p">,</span>
</span><span class='line'>    DATUM<span class="p">[</span><span class="s">&quot;European_Terrestrial_Reference_System_1989&quot;</span><span class="p">,</span>
</span><span class='line'>        SPHEROID<span class="p">[</span><span class="s">&quot;GRS 1980&quot;</span><span class="p">,</span><span class="m">6378137</span><span class="p">,</span><span class="m">298.257222101</span><span class="p">,</span>
</span><span class='line'>            AUTHORITY<span class="p">[</span><span class="s">&quot;EPSG&quot;</span><span class="p">,</span><span class="s">&quot;7019&quot;</span><span class="p">]],</span>
</span><span class='line'>        TOWGS84<span class="p">[</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">],</span>
</span><span class='line'>        AUTHORITY<span class="p">[</span><span class="s">&quot;EPSG&quot;</span><span class="p">,</span><span class="s">&quot;6258&quot;</span><span class="p">]],</span>
</span><span class='line'>    PRIMEM<span class="p">[</span><span class="s">&quot;Greenwich&quot;</span><span class="p">,</span><span class="m">0</span><span class="p">,</span>
</span><span class='line'>        AUTHORITY<span class="p">[</span><span class="s">&quot;EPSG&quot;</span><span class="p">,</span><span class="s">&quot;8901&quot;</span><span class="p">]],</span>
</span><span class='line'>    UNIT<span class="p">[</span><span class="s">&quot;degree&quot;</span><span class="p">,</span><span class="m">0.0174532925199433</span><span class="p">,</span>
</span><span class='line'>        AUTHORITY<span class="p">[</span><span class="s">&quot;EPSG&quot;</span><span class="p">,</span><span class="s">&quot;9122&quot;</span><span class="p">]],</span>
</span><span class='line'>    AUTHORITY<span class="p">[</span><span class="s">&quot;EPSG&quot;</span><span class="p">,</span><span class="s">&quot;4258&quot;</span><span class="p">]],</span>
</span><span class='line'>PROJECTION<span class="p">[</span><span class="s">&quot;Transverse_Mercator&quot;</span><span class="p">],</span>
</span><span class='line'>PARAMETER<span class="p">[</span><span class="s">&quot;latitude_of_origin&quot;</span><span class="p">,</span><span class="m">39.66825833333333</span><span class="p">],</span>
</span><span class='line'>PARAMETER<span class="p">[</span><span class="s">&quot;central_meridian&quot;</span><span class="p">,</span><span class="m">-8.133108333333334</span><span class="p">],</span>
</span><span class='line'>PARAMETER<span class="p">[</span><span class="s">&quot;scale_factor&quot;</span><span class="p">,</span><span class="m">1</span><span class="p">],</span>
</span><span class='line'>PARAMETER<span class="p">[</span><span class="s">&quot;false_easting&quot;</span><span class="p">,</span><span class="m">0</span><span class="p">],</span>
</span><span class='line'>PARAMETER<span class="p">[</span><span class="s">&quot;false_northing&quot;</span><span class="p">,</span><span class="m">0</span><span class="p">],</span>
</span><span class='line'>UNIT<span class="p">[</span><span class="s">&quot;metre&quot;</span><span class="p">,</span><span class="m">1</span><span class="p">,</span>
</span><span class='line'>    AUTHORITY<span class="p">[</span><span class="s">&quot;EPSG&quot;</span><span class="p">,</span><span class="s">&quot;9001&quot;</span><span class="p">]],</span>
</span><span class='line'>AXIS<span class="p">[</span><span class="s">&quot;X&quot;</span><span class="p">,</span>EAST<span class="p">],</span>
</span><span class='line'>AXIS<span class="p">[</span><span class="s">&quot;Y&quot;</span><span class="p">,</span>NORTH<span class="p">],</span>
</span><span class='line'>AUTHORITY<span class="p">[</span><span class="s">&quot;EPSG&quot;</span><span class="p">,</span><span class="s">&quot;3763&quot;</span><span class="p">]]</span>
</span><span class='line'><span class="o">&lt;/</span>code<span class="o">&gt;&lt;/</span>pre<span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span>p<span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>Aí obtém-se a informação de que se necessita, nomeadamente a indicação sobre o datum, o elipsóide, a projecção e as unidades, para determinar se a layer pode ser usada directamente em 
   conjunto com outras, ou se é necessário proceder a alguma transformação. </p>




<p>Estando na posse desta informação, a utilização do QGIS torna-se bastante simples e livre de equívocos.</p>




<p>No canto inferior direito da janela do QGIS, está sempre disponível a indicação do sistema de referência do projecto.</p>




<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/7_srs_projecto_qgis.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/7_srs_projecto_qgis.png" width="500"  alt="Indicação do sistema de referência do projecto no QGIS">
    </a>
</div>




<p>Quando essa indicação se encontra a cinzento, como é o caso da imagem anterior, significa que todos os dados se encontram no mesmo sistema de referência do projecto.</p>




<p>Quando se carrega no projecto uma layer num sistema de referência diferente, a informação do sistema de referência do projecto fica a preto, o que significa que foi activada a 
   transformação 'on the fly'. Os parâmetros utilizados nesta transformação, são os predefinidos pelas bibliotecas GDAL e PROJ.4, que o QGIS importa durante a instalação.</p>




<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/8_srs_projecto_qgis_onthefly.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/8_srs_projecto_qgis_onthefly.png" width="500"  alt="Activar transformação de SRC on the fly">
    </a>
</div>




<p>Para averiguar qual o método de transformação e os respectivos parâmetros utilizados, na tabela de conteúdos, clica-se com o botão direito do rato sobre a layer e escolhe-se 
   “Definir SRC da camada” / “Set layer CRS”. </p>




<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/9_srs_projecto_qgis_onthefly_parametros.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/9_srs_projecto_qgis_onthefly_parametros.png" width="500"  alt="Visualização do método de transformação usado e seus parâmetros">
    </a>
</div>




<p>Verifica-se que, neste caso, se processa uma transformação de 3 parâmetros (Molodensky), com os valores de conversão para datum WGS84 (destacados a vermelho) visíveis na string proj.</p>




<p>Para transformar esta layer no datum Lisboa, de forma permanente, para ETRS89, basta clicar com o botão direito do rato sobre a layer na tabela
   de conteúdos, escolher <b>Guardar como... / Save as...</b> e seleccionar o sistema de referência de destino, neste caso, o PT-TM06/ETRS89 (EPSG:3763). O método e os parâmetros 
   utilizados nessa transformação, são os mesmos da transformação <i>on the fly</i>.</p>




<p>Deste modo, o QGIS permite aos utilizadores visualizar informação em diferentes sistemas de referência, com grande facilidade. Aliás, este processo é de tal forma simplificado pelo 
   QGIS que pode até levar a que os utilizadores menos experientes não se apercebam que os dados têm sistemas de coordenadas distintos. E os parâmetros utilizados pelo QGIS, por defeito,
   são suficientes para a maioria das utilizações.</p>




<p>Contudo, como se viu na introdução, existem métodos mais precisos que outros e parâmetros que conduzem a resultados mais rigorosos que outros, para determinadas áreas do território. 
   Assim, nos capítulos seguintes vai apresentar-se a forma de configurar novos sistemas de referência no QGIS, nomeadamente utilizando as grelhas NTv2 de transformação de coordenadas.</p>




<h3>Transformações de Coordenadas <i>On The Fly</i> no QGIS, usando as grelhas NTv2 de Portugal continental</h3>




<p>A partir da versão 2.2 do QGIS, foi introduzida uma nova ferramenta, designada Datum Transformation, que veio facilitar a utilização dos diversos métodos de transformação de coordenadas, 
   especialmente o método das grelhas, cuja implementação nos softwares de SIG é ainda recente.</p>




<h4>Configuração das transformações 'on the fly' de datum no QGIS para Portugal continental</h4>




<ol>
    <li>O primeiro passo consiste em descarregar os ficheiros das grelhas NTv2 dos sites do prof. José Alberto Gonçalves e da DGT:</li>
        <ul>
            <li><a href="http://www.fc.up.pt/pessoas/jagoncal/coordenadas/parte1.htm" target="_blank">http://www.fc.up.pt/pessoas/jagoncal/coordenadas/parte1.htm</a></li>
            <li><a href="http://www.dgterritorio.pt/cartografia_e_geodesia/geodesia/transformacao_de_coordenadas/grelhas_em_ntv2/" target="_blank">http://www.dgterritorio.pt/cartografia_e_geodesia/geodesia/transformacao_de_coordenadas/grelhas_em_ntv2/</a></li>
        </ul>
        <p>Para facilitar, essas grelhas podem ser descarregadas a partir daqui: <a href="http://qgis.pt/blog/images/dados/grelhas.zip" target="_blank">grelhas.zip</a></p>
    <li>Os ficheiros das grelhas (.gsb) obtidos em 1) colocam-se na pasta utilizada pelo PROJ.4, cuja localização vai depender do Sistema Operativo utilizado e do modo como o QGIS foi 
        instalado:</li>
        <ul>
            <li>Em Linux, os ficheiros das grelhas colocam-se na pasta <b><i>/usr/share/proj</i></b></li>
            <li>Em Windows, tendo usado o instalador OSGeo4W, os ficheiros colocam-se na pasta <b><i>..\OSGeo4W\share\proj</i></b></li>
            <li>Ainda em Windows, tendo usado o instalador standalone, os ficheiros colocam-se na pasta <b><i>..\Program Files\QGIS Chugiak\share\proj</i></b></li>
            <li>Uma outra alternativa é verificar a path da variável de ambiente PROJ_LIB e colocar os ficheiros nessa pasta</li>
        </ul>
        <div class="post-img">
            <a href="http://qgis.pt/blog/images/posts/10_grelhas_pasta_proj.png" rel="prettyPhoto" title="">
                <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/10_grelhas_pasta_proj.png" width="500"  alt="Colocação das grelhas nas pastas adequadas">
            </a>
        </div>
    <li>De seguida, substitui-se a base de dados srs.db que se encontra na pasta /resources, dentro da pasta de instalação do QGIS, por esta: <a href="http://qgis.pt/blog/images/dados/srs_db.zip" target="_blank">srs_db.zip</a> </li>
        <ul>
            <li>Em Linux, a pasta <b><i>/resources</i></b> encontra-se em <b><i>/usr/share/qgis/resources/</i></b></li>
            <li>Em Windows, tendo usado o instalador OSGeo4W, a pasta <b><i>\resources</i></b> encontra-se em <b><i>..\OSGeo4W\apps\QGIS\resources\</i></b></li>
            <li>Tendo usado o instalador standalone, a pasta <b><i>\resources</i></b> encontra-se em <b><i>..\Program Files\QGIS Chugiak\resources\</i></b></li>
        </ul>
        <div class="post-img">
            <a href="http://qgis.pt/blog/images/posts/11_srs_pasta_resources.png" rel="prettyPhoto" title="">
                <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/11_srs_pasta_resources.png" width="500"  alt="Colocação da base de dados de sistemas de referência na pasta adequada">
            </a>
        </div>
        <p>Basicamente, essa base de dados é substituída para evitar confusões nos utilizadores portugueses e disponibilizar apenas os últimos conjuntos de parâmetros de transformação de Bursa-Wolf
           e de Molodensky fornecidos pela DGT [9], bem como as grelhas NTv2 da DGT [11] e do  prof. José Alberto Gonçalves [14].</p>
    <li>Já no QGIS, no menu <b><i>Configurações / Settings -> Opções... / Options... -> separador SRC / CRS</i></b> e activa-se a opção <b><i>Transformações de datum padrão / Default datum
        transformations -> Perguntar pela transformação de datum quando não for definido um padrão / Ask for datum transformation when no default is defined</i></b>. Nesse mesmo separador, 
        selecciona-se a opção <b><i>Habilitar automaticamente a reprojeção on the fly se as camadas tiverem diferentes SRC / Automatically enable on the fly reprojection if layers have 
        different CRS</i></b></li>
        <div class="post-img">
            <a href="http://qgis.pt/blog/images/posts/12_configurar_datum_transformation.png" rel="prettyPhoto" title="">
                <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/12_configurar_datum_transformation.png" width="500"  alt="Configuração das transformações de datum">
            </a>
        </div>
    <li>A partir deste momento, sempre que se carregue informação geográfica (vectores, rasters, wms, wfs, postgis, etc.) no QGIS que se encontre em data diferentes, é aberta uma janela 
        que vai permitir seleccionar o método de transformação (Bursa-Wolf / Molodensky / Grelhas NTv2). A escolha vai depender da vontade de cada utilizador, mas deve basear-se naquilo 
        que é referido na introdução deste texto.</li>
</ol>




<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/13_janela_datum_transformation.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/13_janela_datum_transformation.png" width="500"  alt="Janela da transformação de datum">
    </a>
</div>




<p>No exemplo da imagem anterior, carregou-se a layer da Rede Geodésica Nacional no ETRS89. De seguida, carregou-se uma outra layer da Rede Geodésica Nacional, mais antiga, no datum 73. 
   O QGIS detectou automaticamente que as layers se encontram em sistemas de referência diferentes e apresentou a janela do Datum Transformation, com as 4 possibilidades de transformação 
   da layer no datum 73 para o ETRS89: método de Bursa-Wolf, método de Molodensky, grelhas NTv2 da DGT e grelhas NTv2 do prof. José Alberto Gonçalves. Na metade inferior da janela aparece  
   uma breve descrição de cada um dos métodos, bem como informação acerca do rigor de cada uma das transformações.</p>




<p>O utilizador pode optar por qualquer um dos métodos disponibilizados e pode, inclusivamente, predefinir esse método para que, no futuro, quando surgirem dados que impliquem a mesma 
   transformação, o QGIS a seleccione por defeito.</p>




<p>Ao confirmar, o QGIS activa a transformação 'on the fly' e usa o método de transformação escolhido.</p>




<p>Tal como se referiu anteriormente, as transformações são definidas entre um datum local e um datum global. Este facto vai permitir executar transformações imediatas entre dois data 
   locais, sendo que o Datum Transformation se encarrega de proceder à passagem intermédia pelo datum global (comum a ambos). Deste modo, quando se carrega uma layer no datum 73 e outra 
   no datum Lisboa, num projecto QGIS, o Datum Transformation apresenta todas as possíveis combinações de métodos de transformação entre o datum Lisboa e o WGS84, e o datum 73 e o WGS84. 
   Assim, é realizada uma transformação do datum Lisboa para WGS84 e, deste, para o datum 73, permitindo fazer a transformação entre esses dois data locais pelo método das grelhas, mesmo 
   sem estas terem sido geradas através do cálculo das diferenças de longitude e latitude entre si, mas sim de cada um dos data locais para WGS84/ETRS89.</p>




<div class="post-img">
    <a href="http://qgis.pt/blog/images/posts/14_datum_lx_para_d73.png" rel="prettyPhoto" title="">
        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/14_datum_lx_para_d73.png" width="500"  alt="Transformação de Datum Lisboa para Datum 73">
    </a>
</div>




<p>Uma questão muito importante, que é necessário ter presente, é que este tipo de transformação 'on the fly' é uma transformação em tempo real, isto é, a transformação é feita sobre os 
   dados na sua forma original. Por exemplo, no caso anteriormente apresentado, as layers da Rede Geodésica Nacional mantiveram as suas propriedades originais, a primeira no sistema de 
   referência PT-TM06/ETRS89 (EPSG:3763) e a segunda no sistema de referência Hayford-Gauss datum 73 (EPSG:27493). Por outras palavras, não houve qualquer alteração dos 
   ficheiros armazenados no disco / base de dados. Este procedimento é bastante útil e prático para efeitos de visualização, mas não é suficiente quando o objectivo é efectuar 
   análise espacial e cruzamento de informação entre dados em data diferentes. Para esse efeito, é indispensável ter os dados no mesmo sistema de referência, ou seja, no caso anterior, 
   era necessário guardar uma nova layer no disco, transformada do datum 73 para ETRS89. Esse procedimento também é bastante simples no QGIS, mas implica a utilização de 
   <b><i>SRC Personalizados / Custom CRS</i></b>, isto é, têm de se criar novos sistemas de referência que incluam os parâmetros de transformação entre o datum local e um datum global, 
   neste caso, o WGS84.</p>




<h3>Transformações de Coordenadas no QGIS usando as grelhas NTv2 de Portugal continental – Sistemas de Referência Personalizados</h3>




<p>Esta segunda forma de transformação de coordenadas no QGIS permite a criação de layers no novo sistema de referência, usando um dos métodos apresentados anteriormente.</p>




<h4>Configuração das transformações de datum no QGIS para Portugal continental através da criação de Sistemas de Referência Personalizados</h4>




<p>Os dois primeiros passos descritos de seguida são exactamente os mesmos que se efectuaram no procedimento de configuração das transformações <i>on the fly</i>, pelo que, se já os tiverem 
   realizado, podem passar para o passo 3.</p>




<ol>
    <li>O primeiro passo consiste em descarregar os ficheiros das grelhas NTv2 dos sites do prof. José Alberto Gonçalves e da DGT:</li>
        <ul>
            <li><a href="http://www.fc.up.pt/pessoas/jagoncal/coordenadas/parte1.htm" target="_blank">http://www.fc.up.pt/pessoas/jagoncal/coordenadas/parte1.htm</a></li>
            <li><a href="http://www.dgterritorio.pt/cartografia_e_geodesia/geodesia/transformacao_de_coordenadas/grelhas_em_ntv2/" target="_blank">http://www.dgterritorio.pt/cartografia_e_geodesia/geodesia/transformacao_de_coordenadas/grelhas_em_ntv2/</a></li>
        </ul>
        <p>Para facilitar, essas grelhas podem ser descarregadas a partir daqui: <a href="http://qgis.pt/blog/images/dados/grelhas.zip" target="_blank">grelhas.zip</a></p>
    <li>Os ficheiros das grelhas (.gsb) obtidos em 1) colocam-se na pasta utilizada pelo PROJ.4, cuja localização vai depender do Sistema Operativo utilizado e do 
        modo como o QGIS foi instalado</li>
        <ul>
            <li>Em Linux, os ficheiros das grelhas colocam-se na pasta <b><i>/usr/share/proj</i></b></li>
            <li>Em Windows, tendo usado o instalador OSGeo4W, os ficheiros colocam-se na pasta <b><i>..\OSGeo4W\share\proj</i></b></li>
            <li>Ainda em Windows, tendo usado o instalador standalone, os ficheiros colocam-se na pasta <b><i>..\Program Files\QGIS Chugiak\share\proj</i></b></li>
            <li>Uma outra alternativa é verificar a <i>path</i> da variável de ambiente PROJ_LIB e colocar os ficheiros nessa pasta</li>
        </ul>
    <li>No QGIS -> menu <b><i>Configurações / Settings -> SRC Personalizado... / Custom CRS...</i></b>, cria-se um novo sistema de referência 
        (<b><i>Adicionar novo SRC / Add New CRS</i></b>) com a seguinte definição:</li>
        <ul>
            <li><b>Nome:</b> Datum_Lisboa_Hayford_Gauss_Militar_Grelhas_JAG_20790</li>
            <li><b>Parâmetros:</b> +proj=tmerc +lat_0=39.66666666666666 +lon_0=1 +k=1 +x_0=200000 +y_0=300000 +ellps=intl +nadgrids=ptLX_e89.gsb +wktext +pm=lisbon +units=m +no_defs</li>
        </ul>
        <div class="post-img">
            <a href="http://qgis.pt/blog/images/posts/15_src_personalizado.png" rel="prettyPhoto" title="">
                <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/15_src_personalizado.png" width="500"  alt="Configuração de SRC personalizado">
            </a>
        </div>
    <li>Criam-se, da forma descrita anteriormente, tantos SRC personalizados quantos se necessite. De seguida disponibilizam-se os que, eventualmente, serão mais utilizados em Portugal continental:</li>
    <table class="table">
        <tr>
            <td rowspan="2">1.</td>
            <td><b>Nome:</b></td>
            <td>Datum_Lisboa_Hayford_Gauss_Grelhas_JAG_20791</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=1 +k=1 +x_0=0 +y_0=0 +ellps=intl +nadgrids=ptLX_e89.gsb +wktext +pm=lisbon +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">2.</td>
            <td><b>Nome:</b></td>
            <td>Datum73_Hayford_Gauss_Grelhas_JAG_27493</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=-8.131906111111112 +k=1 +x_0=180.598 +y_0=-86.99 +ellps=intl +nadgrids=pt73_e89.gsb +wktext +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">3.</td>
            <td><b>Nome:</b></td>
            <td>Datum73_Hayford_Gauss_Militar_Grelhas_JAG</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=-8.131906111111112 +k=1 +x_0=200180.598 +y_0=299913.01 +ellps=intl +nadgrids=pt73_e89.gsb +wktext +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">4.</td>
            <td><b>Nome:</b></td>
            <td>UTM_29N_ED50_Grelhas_JAG_23029</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=utm +zone=29 +ellps=intl +nadgrids=ptED_e89.gsb +wktext +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">5.</td>
            <td><b>Nome:</b></td>
            <td>Datum_Lisboa_Hayford_Gauss_Militar_Grelhas_DGT_20790 </td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=1 +k=1 +x_0=200000 +y_0=300000 +ellps=intl +nadgrids=DLX_ETRS89_geo.gsb +wktext +pm=lisbon +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">6.</td>
            <td><b>Nome:</b></td>
            <td>Datum_Lisboa_Hayford_Gauss_Grelhas_DGT_20791</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=1 +k=1 +x_0=0 +y_0=0 +ellps=intl +nadgrids=DLX_ETRS89_geo.gsb +wktext +pm=lisbon +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">7.</td>
            <td><b>Nome:</b></td>
            <td>Datum73_Hayford_Gauss_Grelhas_DGT_27493</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=-8.131906111111112 +k=1 +x_0=180.598 +y_0=-86.99 +ellps=intl +nadgrids=D73_ETRS89_geo.gsb +wktext +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">8.</td>
            <td><b>Nome:</b></td>
            <td>Datum73_Hayford_Gauss_Militar_Grelhas_DGT</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=-8.131906111111112 +k=1 +x_0=200180.598 +y_0=299913.01 +ellps=intl +nadgrids=D73_ETRS89_geo.gsb +wktext +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">9.</td>
            <td><b>Nome:</b></td>
            <td>Datum_Lisboa_Hayford_Gauss_Militar_Bursa_Wolf_DGT_20790</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=1 +k=1 +x_0=200000 +y_0=300000 +ellps=intl +towgs84=-283.088,-70.693,117.445,-1.157,0.059,-0.652,-4.058 +pm=lisbon +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">10.</td>
            <td><b>Nome:</b></td>
            <td>Datum_Lisboa_Hayford_Gauss_Bursa_Wolf_DGT_20791</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=1 +k=1 +x_0=0 +y_0=0 +ellps=intl +towgs84=-283.088,-70.693,117.445,-1.157,0.059,-0.652,-4.058 +pm=lisbon +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">11.</td>
            <td><b>Nome:</b></td>
            <td>Datum73_Hayford_Gauss_Bursa_Wolf_DGT_27493</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=-8.131906111111112 +k=1 +x_0=180.598 +y_0=-86.99 +ellps=intl +towgs84=-230.994,102.591,25.199,0.633,-0.239,0.900,1.950 +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">12.</td>
            <td><b>Nome:</b></td>
            <td>Datum_Lisboa_Hayford_Gauss_Militar_Molodensky_DGT_20790</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=1 +k=1 +x_0=200000 +y_0=300000 +ellps=intl +towgs84=-303.861,-60.693,103.607 +pm=lisbon +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">13.</td>
            <td><b>Nome:</b></td>
            <td>Datum_Lisboa_Hayford_Gauss_Molodensky_DGT_20791</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=1 +k=1 +x_0=0 +y_0=0 +ellps=intl +towgs84=-303.861,-60.693,103.607 +pm=lisbon +units=m +no_defs</td>
        </tr>
        <tr>
            <td rowspan="2">13.</td>
            <td><b>Nome:</b></td>
            <td>Datum73_Hayford_Gauss_Molodensky_DGT_27493</td>
        </tr>
        <tr>
            <td><b>Parâmetros:</b></td>
            <td>+proj=tmerc +lat_0=39.66666666666666 +lon_0=-8.131906111111112 +k=1 +x_0=180.598 +y_0=-86.99 +ellps=intl +towgs84=-223.150,110.132,36.711 +units=m +no_defs</td>
        </tr>
    </table>
    <p>Em alternativa à introdução manual, disponibiliza-se uma versão da base de dados qgis.db, com os <b><i>Custom CRS</i></b> já introduzidos: <a href="http://qgis.pt/blog/images/dados/qgis_db.zip" target="_blank">qgis_db.zip</a></p>

    <p>Este ficheiro deve substituir os ficheiros com o mesmo nome que se encontram na pasta <b><i>/resources</i></b> e na pasta QGIS do utilizador (.qgis2):</p>

    <ul>
        <li>../resources/qgis.db:</li>
            <ol>
                <li>Em Linux, a pasta <b><i>/resources</i></b> encontra-se em <b><i>/usr/share/qgis/resources/</i></b></li>
                <li>Em Windows, tendo usado o instalador OSGeo4W, a pasta <b><i>\resources</i></b> encontra-se em <b><i>..\OSGeo4W\apps\QGIS\resources\</i></b></li>
                <li>Tendo usado o instalador standalone, a pasta <b><i>\resources</i></b> encontra-se em <b><i>..\Program Files\QGIS Chugiak\resources\</i></b></li>
            </ol>
        <li>~/.qgis2/qgis.db:</li>
            <ol>
                <li>Em Linux, a pasta <b><i>/.qgis2</i></b> encontra-se em <b><i>/home/nome_do_utilizador/.qgis2/</i></b></li>
                <li>Em Windows, a pasta <b><i>\.qgis2</i></b> encontra-se em <b><i>C:\Users\nome_do_utilizador\.qgis2\</i></b></li>
            </ol>
    </ul>

    <p>A base de dados qgis.db surge em dois locais diferentes porque, na primeira vez, após a instalação, que cada utilizador do computador corre o QGIS, é criada uma pasta denominada .qgis2 
       na sua pasta pessoal. Esta inclui uma qgis.db, que é cópia da base de dados existente em ../resources/qgis.db. Ou seja, se esta última estiver vazia, é criada uma cópia vazia na pasta 
       do utilizador. Se tiver alguma informação, a cópia na pasta do utilizador vai ficar com esse conteúdo. </p>

    <p>O problema é que, uma vez criada, a ~/.qgis2/qgis.db não é mais alterada por esta via. Ou seja, mesmo colocando uma versão já com os <b><i>Custom CRS</i></b> em /resources/qgis.db, 
       estes não aparecem no QGIS. Só irão aparecer se novos utilizadores do computador arrancarem o QGIS a partir das suas contas pessoais.</p>
       
    <p>Por esse motivo, quem já utiliza o QGIS, necessita de substituir ~/.qgis2/qgis.db pela versão fornecida, tendo em atenção que é também nessa base de dados que ficam guardados os 
       bookmarks do utilizador. Assim, se tiverem bookmarks criados, ao fazerem a substituição, irão perdê-los. </p>
       
    <div class="post-img">
        <a href="http://qgis.pt/blog/images/posts/16_src_personalizados.png" rel="prettyPhoto" title="">
            <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/16_src_personalizados.png" width="500"  alt="Janela dos SRC">
        </a>
    </div>
       
    <li>Tome-se agora, como exemplo, a layer da Rede Geodésica Nacional no Hayford-Gauss datum 73 e imagine-se que se pretende transformá-la, de forma permanentemente, para o ETRS89.</li>
        <ul>
            <li>Começa por se carregar essa layer no QGIS</li>
            <li>Por defeito, ela vai assumir o sistema de referência em que foi produzida, neste caso, o datum 73 com a definição do PROJ.4 (EPSG:27493)</li>
            <li>Para se usarem as grelhas, por exemplo da DGT, na transformação, é necessário indicar ao QGIS o sistema que tem, nos parâmetros de transformação, as grelhas (parâmetro 
                +nadgrids), ou seja, atribui-se à layer o sistema de referência correspondente, que se criou no passo 4</li>
            <li>Para isso, na tabela de conteúdos, clica-se com o botão direito do rato sobre a layer e escolhe-se <b><i>Definir SRC da camada / Set layer CRS</i></b>. Dentro dos 
                <b><i>Sistemas de Coordenadas definidos pelo utilizadores / User Defined Coordinate Systems</i></b>, escolhe-se o Datum73_Hayford_Gauss_Grelhas_DGT_27493</li>
                <div class="post-img">
                    <a href="http://qgis.pt/blog/images/posts/17_set_user_defined_crs.png" rel="prettyPhoto" title="">
                        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/17_set_user_defined_crs.png" width="500"  alt="Definir o SRC personalizado">
                    </a>
                </div>
            <li>De seguida, clica-se novamente com o botão direito do rato sobre a layer e escolhe-se <b><i>Guardar como... / Save as...</i></b>. Na janela que se abre, escolhe-se o 
                formato de saída, dá-se o caminho para guardar a nova layer e selecciona-se o sistema de referência de destino, neste caso, o PT-TM06/ETRS89. Ao clicar em <b><i>Ok</i></b>, 
                a layer é guardada no novo sistema de referência.</li>
                <div class="post-img">
                    <a href="http://qgis.pt/blog/images/posts/18_janela_guardar_como.png" rel="prettyPhoto" title="">
                        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/18_janela_guardar_como.png" width="500"  alt="Janela Guardar camada como">
                    </a>
                </div>
                <p>Este procedimento pode ser executado em lote, para várias layers em simultâneo, através da ferramenta <b><i>Reproject layer</i></b> do Processing [15].</p>
            <li>Para confirmar a transformação, pode abrir-se um novo projecto QGIS e carregar a layer acabada de transformar e a layer da Rede Geodésica Nacional em ETRS89.</li>
                <div class="post-img">
                    <a href="http://qgis.pt/blog/images/posts/19_erro_grelhas_dgt_vg_pinhel.png" rel="prettyPhoto" title="">
                        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/19_erro_grelhas_dgt_vg_pinhel.png" width="500"  alt="Erros associados à transformação">
                    </a>
                </div>
                <p>Na imagem consegue perceber-se que o erro na transformação com a grelha NTv2 da DGT, por exemplo, para o caso do vértice geodésico “Pinhel” foi de, aproximadamente, 
                   2.5mm. O que é um resultado excelente.</p>
                   
                <p>Para testar, em simultâneo, a transformação <b><i>on the fly</i></b>, carrega-se a layer original no datum 73 e escolhe-se a mesma grelha na janela do Datum 
                   Transformation. O resultado, visível na imagem seguinte, é elucidativo do bom funcionamento de ambas as formas de transformação presentes no QGIS, atendendo a que os 
                   pontos (estrela verde e círculo azul) surgem sobrepostos.</p>
                
                 <div class="post-img">
                    <a href="http://qgis.pt/blog/images/posts/20_erro_grelhas_dgt_vg_pinhel_datum_transf.png" rel="prettyPhoto" title="">
                        <img class="img-responsive thumbnail" src="http://qgis.pt/blog/images/posts/20_erro_grelhas_dgt_vg_pinhel_datum_transf.png" width="500"  alt="Erros associados à transformação">
                    </a>
                </div>


        </ul>
</ol>




<p>Desta forma, o utilizador dispõe agora dos melhores métodos de transformação dos sistemas de coordenadas nacionais antigos para o ETRS89, e pode efectuar essas operações, com grande 
   facilidade, no QGIS.</p>




<h3>Referências</h3>


<p>[1] Matos, J. (2008). “Fundamentos de Informação Geográfica” . 5ª Edição. Lisboa: Lidel</p>


<p>[2] <a class="wrap-url" href="http://www3.nfb.ca/animation/objanim/en/films/film.php?sort=title&id=14229" target="_blank">http://www3.nfb.ca/animation/objanim/en/films/film.php?sort=title&id=14229</a></p>


<p>[3] <a class="wrap-url" href="http://www.esa.int/spaceinimages/Images/2011/03/New_GOCE_geoid " target="_blank">http://www.esa.int/spaceinimages/Images/2011/03/New_GOCE_geoid </a></p>


<p>[4] <a class="wrap-url" href="http://www.aprh.pt/rgci/glossario/elipsoide-de-referencia.html." target="_blank">http://www.aprh.pt/rgci/glossario/elipsoide-de-referencia.html.</a></p>


<p>[5] Gonçalves, J., 2008. Adopção de Sistemas de Referenciação Geográfica Globais. ESIG2008 (<a class="wrap-url" href="http://www.fc.up.pt/pessoas/jagoncal/coordenadas/paper_esig2008.pdf" target="_blank">http://www.fc.up.pt/pessoas/jagoncal/coordenadas/paper_esig2008.pdf</a>)</p>


<p>[6] Fernandes, M., 2008. Cartografia - programa, conteúdos e métodos de ensino. FLUP (<a class="wrap-url" href="http://ler.letras.up.pt/uploads/ficheiros/5901.pdf" target="_blank">http://ler.letras.up.pt/uploads/ficheiros/5901.pdf</a>)</p>


<p>[7] Gonçalves, J., 2009. Conversões de Sistemas de Coordenadas Nacionais para ETRS89 Utilizando Grelhas. VI CNCG (<a class="wrap-url" href="http://www.fc.up.pt/pessoas/jagoncal/coordenadas/paper_cncg2009.pdf" target="_blank">http://www.fc.up.pt/pessoas/jagoncal/coordenadas/paper_cncg2009.pdf</a>)</p>


<p>[8] Gonçalves, J., 2008. Conversões de coordenadas com o programa PROJ - Método de conversão com grelhas. SASIG2008 (<a class="wrap-url" href="http://www.fc.up.pt/pessoas/jagoncal/coordenadas/paper_sasig2009.pdf" target="_blank">http://www.fc.up.pt/pessoas/jagoncal/coordenadas/paper_sasig2009.pdf</a>)</p>


<p>[9] <a class="wrap-url"href="http://www.dgterritorio.pt/cartografia_e_geodesia/geodesia/transformacao_de_coordenadas/parametros_de_transformacao_de_coordenadas/" target="_blank">http://www.dgterritorio.pt/cartografia_e_geodesia/geodesia/transformacao_de_coordenadas/parametros_de_transformacao_de_coordenadas/</a></p>


<p>[10] <a class="wrap-url" href="http://nsnig.igeo.pt/eventos/comunicacoes/Caldas_da_Rainha/CNCG2009-AnaBernardes.pdf" target="_blank">http://nsnig.igeo.pt/eventos/comunicacoes/Caldas_da_Rainha/CNCG2009-AnaBernardes.pdf</a></p>


<p>[11] <a class="wrap-url" href="http://www.dgterritorio.pt/cartografia_e_geodesia/geodesia/transformacao_de_coordenadas/grelhas_em_ntv2/" target="_blank">http://www.dgterritorio.pt/cartografia_e_geodesia/geodesia/transformacao_de_coordenadas/grelhas_em_ntv2/</a></p>


<p>[12] <a class="wrap-url" href="http://www.epsg.org/" target="_blank">http://www.epsg.org/</a></p>


<p>[13] <a class="wrap-url" href="http://epsg.io/" target="_blank">http://epsg.io/</a></p>


<p>[14] <a class="wrap-url" href="http://www.fc.up.pt/pessoas/jagoncal/coordenadas/parte1.htm" target="_blank">http://www.fc.up.pt/pessoas/jagoncal/coordenadas/parte1.htm</a></p>


<p>[15] <a class="wrap-url" href="http://qgis.pt/workshops_qgis2014/ws_processing_qgis_day_2014.pdf" target="_blank">http://qgis.pt/workshops_qgis2014/ws_processing_qgis_day_2014.pdf</a></p>




<br />


<p><img class="gravatar img-circle" src="http://www.gravatar.com/avatar/936b29d10dd4b8799759da81c18edb88></img></p>
]]></content>
  </entry>
  
</feed>
